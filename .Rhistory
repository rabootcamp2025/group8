library(tidyverse)
library(haven)
getwd()
read_dta("D:/china_syndrome/group8/Autor-Dorn-Hanson-ChinaSyndrome-FileArchive/dta/export_levels.dta")
# データ読み込み -----------------------------------------------------------------
workfile_china
データ読み込み
read_dta("Autor-Dorn-Hanson-ChinaSyndrome-FileArchive/dta/workfile_china.dta")
# データ読み込み -----------------------------------------------------------------
workfile_china <-
read_dta("Autor-Dorn-Hanson-ChinaSyndrome-FileArchive/dta/workfile_china.dta")
# データ読み込み -----------------------------------------------------------------
df_china <-
read_dta("Autor-Dorn-Hanson-ChinaSyndrome-FileArchive/dta/workfile_china.dta")
rm(workfile_china)
View(df_china)
str(df_china)
names(df_china)
df_china |>
select(d_*)
df_china |>
select(starts_with("d_"))
df_china |>
names |>
pull(starts_with("d_"))
df_china |>
select(starts_with("d_")) |>
names
df_china |>
select(starts_with("d_")) |>
names()
df_china |>
select(d_tradeusce_pw ) |>
summary()
df_china |>
select(yr, d_tradeusce_pw)
df_china |>
select(yr, d_tradeusce_pw) |>
group_by(yr) |>
summary()
df_china |>
select(yr, d_tradeusce_pw) |>
group_by(yr) |>
summarise()
df_china |>
select(yr, d_tradeusce_pw) |>
group_by(yr) |>
summarise(d_tradeusce_pw)
df_china |>
select(yr, d_tradeusce_pw) |>
group_by(yr) |>
summarise(summary(d_tradeusce_pw))
df_china |>
select(yr, d_tradeusce_pw) |>
group_by(yr) |>
summarise(mn = mean(d_tradeusce_pw))
df_china |>
select(yr, d_tradeusce_pw) |>
group_by(yr) |>
summarise(mean = mean(d_tradeusce_pw))
#App Table1
df_china |>
group_by(yr) |>
summarize(
w_mean = weighted.mean(d_tradeusce_pw, timepwt48)
)
?weighted.quantile
?weighted.quantile()
?weighted.quantile()
?weighted.mean
help(, stats)
help(weighted.mean)
help(, stats)
library(Hmisc)
install.packages(Hmics)
install.packages("Hmisc")
library(Hmisc)
#App Table1
df_china |>
group_by(yr) |>
summarize(
w_10 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.10)
w_50 = weighted.mean(d_tradeusce_pw, timepwt48)
#App Table1
df_china |>
group_by(yr) |>
summarize(
w_10 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.10),
w_50 = weighted.mean(d_tradeusce_pw, timepwt48)
)
?wtd.quantile
#App Table1
df_china |>
group_by(yr) |>
dplyr::summarize(
w_10 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.10),
w_50 = weighted.mean(d_tradeusce_pw, timepwt48)
)
#App Table1
df_china |>
group_by(yr) |>
dplyr::summarize(
w_10 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.10),
w_25 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.25),
w_50 = weighted.mean(d_tradeusce_pw, timepwt48),
)
#App Table1
df_china |>
group_by(yr) |>
dplyr::summarize(
w_10 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.10),
w_25 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.25),
w_50 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.5),
w_m = weighted.mean(d_tradeusce_pw, timepwt48),
)
#App Table1
df_china |>
group_by(yr) |>
dplyr::summarize(
w_10 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.10),
w_25 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.25),
w_50 = wtd.quantile(d_tradeusce_pw, weights = timepwt48, probs = 0.5)#,
#w_m = weighted.mean(d_tradeusce_pw, timepwt48)
)
install.packages("modi")
library(modi)
?weighted.quantile
#App Table1
df_china |>
group_by(yr) |>
dplyr::summarize(
w_10 = weighted.quantile(d_tradeusce_pw, timepwt48, prob = 0.10),
w_25 = weighted.quantile(d_tradeusce_pw, timepwt48, prob = 0.25),
w_50 = weighted.quantile(d_tradeusce_pw, timepwt48, prob = 0.5),
w_m = weighted.mean(d_tradeusce_pw, timepwt48)
)
df_china |>
select(yr, d_tradeusce_pw, timepwt48) |> str()
#App Table1
df_china |>
group_by(yr) |>
dplyr::summarize(
count = n(),
w_10 = weighted.quantile(d_tradeusce_pw, timepwt48, prob = 0.10),
w_25 = weighted.quantile(d_tradeusce_pw, timepwt48, prob = 0.25),
w_50 = weighted.quantile(d_tradeusce_pw, timepwt48, prob = 0.5),
w_m = weighted.mean(d_tradeusce_pw, timepwt48)
)
?wtd.quantile
# パッケージ読み込み ---------------------------------------------------------------
library(tidyverse)
library(haven)
library(modi)
# データ読み込み -----------------------------------------------------------------
df_china <-
read_dta("Autor-Dorn-Hanson-ChinaSyndrome-FileArchive/dta/workfile_china.dta")
df_china |>
select(starts_with("d_")) |>
names()
df_china |>
select(d_tradeusce_pw ) |>
summary()
# データの確認のため
df_china |>
select(yr, d_tradeusce_pw) |>
group_by(yr) |>
summarise(mean = mean(d_tradeusce_pw))
#App Table1
df_china |>
group_by(yr) |>
dplyr::summarize(
w_10 = weighted.quantile(d_tradeusce_pw, timepwt48, prob = 0.10),
w_25 = weighted.quantile(d_tradeusce_pw, timepwt48, prob = 0.25),
w_50 = weighted.quantile(d_tradeusce_pw, timepwt48, prob = 0.5),
w_m = weighted.mean(d_tradeusce_pw, timepwt48)
)
library(Hmisc)
# パッケージ読み込み ---------------------------------------------------------------
library(tidyverse)
#App Table1
df_china |>
group_by(yr) |>
dplyr::summarize(
w_10 = weighted.quantile(d_tradeusch_pw, timepwt48, prob = 0.10),
w_25 = weighted.quantile(d_tradeusch_pw, timepwt48, prob = 0.25),
w_50 = weighted.quantile(d_tradeusch_pw, timepwt48, prob = 0.5),
w_m = weighted.mean(d_tradeusce_pw, timepwt48)
)
#App Table1
df_china |>
group_by(yr) |>
dplyr::summarize(
w_10 = weighted.quantile(d_tradeusch_pw, timepwt48, prob = 0.10),
w_25 = weighted.quantile(d_tradeusch_pw, timepwt48, prob = 0.25),
w_50 = weighted.quantile(d_tradeusch_pw, timepwt48, prob = 0.5),
w_75 = weighted.quantile(d_tradeusch_pw, timepwt48, prob = 0.75),
w_90 = weighted.quantile(d_tradeusch_pw, timepwt48, prob = 0.9)
)
df_china[, "l_popcount"]
df_china |>
pull(l_popcount)
df_china |>
select(l_popcount)
df_china[, "l_popcount"]
df_china |>
select(l_popcount)
df_china |>
select(city, l_popcount)
?arrange
#App Table1 panel B
df_china |>
filter(yr == 1990) |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(l_popcount)
#App Table1 panel B
df_china |>
filter(yr == 1990) |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(l_popcount))
#App Table1 panel B
df_china |>
filter(yr == 1990) |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(d_tradeusch_pw))
#App Table1 panel B
df_china |>
filter(yr == 1990) |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(l_popcount)) |>
print(n=40)
#App Table1 panel B
df_china |>
filter(yr == 1990) |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(l_popcount)) |>
slice(40)
#App Table1 panel B
df_china |>
filter(yr == 1990) |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(l_popcount)) |>
slice(1:40)
#App Table1 panel B
df_china |>
filter(yr == 1990) |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(l_popcount)) |>
slice(1:40) |>
arrange(desc(d_tradeusch_pw))
#App Table1 panel B
#2000-2007
df_china |>
filter(yr == 2000) |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(l_popcount)) |>
slice(1:40) |>
arrange(desc(d_tradeusch_pw))
df_china |>
filter(yr == 1990) |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(l_popcount)) |>
mutate(
pop40 = if_else(row_number() <= 40, 1, 0)
)
df_china |>
select(czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(l_popcount)) |>
mutate(
pop40 = if_else(yr == 1990 & row_number() <= 40, 1, 0)
)
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
arrange(desc(l_popcount)) |>
mutate(
pop40 = if_else(yr == 1990 & row_number() <= 40, 1, 0)
)
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(yr == 1990 & row_number() <= 40, 1, 0)
)
#App Table1 panel B
# df_china_top40 <-
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(row_number() <= 40, 1, 0)
)
#App Table1 panel B
# df_china_top40 <-
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(row_number() <= 40, 1, 0)
) |>
print(41)
#App Table1 panel B
# df_china_top40 <-
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(row_number() <= 40, 1, 0)
) |>
print(n = 41)
#App Table1 panel B
# df_china_top40 <-
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(yr == 1990 & row_number() <= 40, 1, 0)
) |>
print(n = 41)
#App Table1 panel B
# df_china_top40 <-
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(yr == 1990 & row_number() <= 40, 1, 0)
) |>
group_by(czone) |>
mutate(top40 = sum(pop40))
#App Table1 panel B
# df_china_top40 <-
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(yr == 1990 & row_number() <= 40, 1, 0)
) |>
group_by(czone) |>
mutate(top40 = sum(pop40)) |>
print(n = 50)
#App Table1 panel B
# df_china_top40 <-
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(yr == 1990 & row_number() <= 40, 1, 0)
) |>
group_by(czone) |>
mutate(top40 = sum(pop40)) |>
filter(yr == 2000) |>
print(n = 50)
#App Table1 panel B
# df_china_top40 <-
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(yr == 1990 & row_number() <= 40, 1, 0)
) |>
group_by(czone) |>
mutate(top40 = sum(pop40)) |>
filter(city == "New Orleans LA") |>
print(n = 50)
#App Table1 panel B
# df_china_top40 <-
df_china |>
select(yr, czone, city, d_tradeusch_pw, l_popcount) |>
mutate(pop1990 = if_else(yr == 1990, l_popcount, 0)) |>
arrange(desc(pop1990)) |>
mutate(
pop40 = if_else(yr == 1990 & row_number() <= 40, 1, 0)
) |>
group_by(czone) |>
mutate(top40 = sum(pop40)) |>
filter(top40 == 1) |>
print(n = 50)
